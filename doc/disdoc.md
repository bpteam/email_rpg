### Дизайн документ

# Email RPG

## Прообраз

Книги Дмитрия Браславского ["Подземелье черного замка"](http://fantasy-worlds.org/lib/id17684/read/) 
\([mirror](http://www.evernote.com/l/AI78uvBhNHRIcrUoSdoEE7dTDL2GvISA_Rc/)\). В нее я играл в далеком 2001 или 2002,
засел на пару вечеров. Минус книжного варианта в том, что можно соблазниться и легко читерить, побеждать в проиграшнем 
сражении или возвращаться назад и делать другой выбор. Больше информации про книга-игра можно почитать на 
[Wikipedia](https://ru.wikipedia.org/wiki/%D0%9A%D0%BD%D0%B8%D0%B3%D0%B0-%D0%B8%D0%B3%D1%80%D0%B0)

## Похожие игры

- [Колдун огнееной горы](http://quest-book.ru/forum/gamebook/wotfm/) HTML JS.
- Книжный варианты. Список на [Wikipedia](https://ru.wikipedia.org/wiki/%D0%9A%D0%BD%D0%B8%D0%B3%D0%B0-%D0%B8%D0%B3%D1%80%D0%B0)
- [The Forest of Doom](http://store.steampowered.com/app/270490/) стоит в Steam $7.

## Целевая аудитория

- Офисный планктон у которого доступна только Email;

## Визуальный стиль

Растянуть изображение свитка на все окно. Так как весь контент текстовый можно сделать в центре текст параграфа, а внизу
игровые параметры(характеристика, инвентарь). На подобии панелек во всех RPG на PC.

## Узнаваемые элементы

...

## Персонажи

- Протагонист - самоуверенный дурак, который толком ничего не знает лезет на ражен.
- NPC - их там тьма, чтоб их описать нужно книгу снова перечитывать, в общем не стоит оно того. Иногда продают персонажу
или просят что-то у него, чаще нападают.
- Антагонист - Колдун, властелин темной магии и хитрожопый мужик с странным вкусом в архитектуре.

### Описание персонажей

У каждого персонажа есть параметры:

- Мастерство
- Выносливось

Персонаж может носить сумку с вещами и у некоторых есть золото в корманах. На тело персонаж может одевать одежду или
доспехи{126,498}. В руках может держать щит, меч, двуручное оружие или другие пригодные для удержания предметы.

Можно напускать чары как на себя так и на противника, некоторые персонажи воспринимают заклятия не стандартным способом.
К примеру зеленый рыцарь и его щит{395}.
Применение предметов на себя и на других персонажей, и соответственно обработка событий после этих действий{355}.


#### Перечень персонажей

| Имя | Мастерство | Выносливость | Золото | Инвентарь | Параграф |
| :-: | ---------: | -----------: | -----: | :-------- | -------: |
| Первый дровосек | 5 | 4 | 1 | | 6 |
| Второй дровосек | 6 | 7 | | | 6 |
| Первая летучая мышь | 6 | 8 | | | 16 |
| Вторая летучая мышь | 5 | 7 | | | 16 |
| Третья летучая мышь | 5 | 6 | | | 16 |
| Орк | 6 | 8 | | Серебряный свиток | 33 |
| Гоблин | 7 | 5 | | | 33 |
| Дракон | 9 | 4 | | | 37 |
| Первый гоблин | 6 | 9 | | Бронзовый свиток | 40 |
| Второй гоблин | 7 | 5 | | Медный ключик | 40 |
| Дракон | 9 | 4 | | | 41 |
| Гигантский паук | 8 | 8 | 1 | Прекрасный бриллиант, золотой свиток | 54 |
| Начальник стражи | 9 | 5 | | | 65 |
| Женщина-вампир | 11 | 14 | | | 93 |
| Гоблин | 8 | 9 | | | 102 |
| Зеленый рыцарь | 10 | 10 | | | 112 |
| Первый разбойник | 6 | 4 | 7 | перо аиста, пустой бронзовый кувшин | 123 |
| Второй разбойник | 7 | 8 | | | 123 |
| Третий разбойник | 5 | 5 | | | 123 |
| Превый зеленый рыцарь | 10 | 10 | | | 183 |
| Второй зеленый рыцарь | 10 | 10 | | | 183 |
| Гоблин | 7 | 9 | | Бронзовый свиток | 192 |
| Обезьяна | 9 | 14 | | | 215 |
| Гигантский паук | 5 | 8 | | | 219 |
| Паук | 8 | 8 | | | 244 |
| Дух мертвых | 10 | 12 | | | 247 |
| Лев | 9 | 15 | | | 257 |
| Гиена | 6 | 6 | | | 265 |
| Гоблин | 6 | 9 | | Бронзовый свиток, медный ключ | 290 |
| Барлад Дэрт | 14 | 12 | | | 293 |
| Первый рыцарь | 10 | 10 | | | 301 |
| Второй рыцарь | 10 | 10 | | | 301 |
| Третий рыцарь | 10 | 10 | | | 301 |
| Капитан рыцарей | 12 | 12 | | | 301 |
| Зеленый рыцарь | 10 | 10 | | | 309 |
| Дракон | 12 | 8 | | | 316 |
| Водяной | 7 | 7 | | | 326 |
| Первый орк | 8 | 5 | | | 328 |
| Второй орк | 7 | 7 | | | 328 |
| Тролль | 9 | 14 | | Золотое кольцо | 356 |
| Первый человек | 8 | 5 | | | 374 |
| Второй человек | 6 | 9 | | | 374 |
| Первый орк | 10 | 6 | | | 487 |
| Второй орк | 7 | 7 | | | 487 |
| Третий орк | 7 | 7 | | | 487 |
| Орк | 7 | 7 | | | 499 |
| Торговец | 6 | 12 | | | 518 |
| Оборотень | 10 | 10 | | Оберег | 528 |
| Медведица | 8 | 10 | | | 529 |
| Первый гоблин | 8 | 10 | | | 532 |
| Второй гоблин | 6 | 8 | | | 532 |
| Гоблин | 4 | 7 | | | 538 |
| Второй гоблин | 8 | 9 | | | 538 |
| Зеленый рыцарь | 11 | 14 | | | 543 |
| Гарпия | 10 | 12 | | | 553 |
| Гигантский паук | 8 | 8 | 1 | Прекрасный бриллиант, золотой свиток | 558 |
| Лесовичок | 6 | 8 | | Серебряный свиток | 563 |
| Первый орк | 10 | 6 | | | 569 |
| Второй орк | 7 | 7 | | | 569 |
| Третий орк | 7 | 7 | | | 569 |
| Первый гоблин | 4 | 9 | | Бронзовый свиток | 580 |
| Второй гоблин | 7 | 5 | | Медный ключик | 580 |
| Повар | 8 | 10 | | | 604 |

# Игровые правила

Принцип игры - вы перемещаетесь по параграфам и делаете выбор, куда свернуть, что сделать, кому сказать, кому показать, 
кого убить. Иногда встречаются враги с которыми можно сражаться, иногда мирные персонажы с которыми можно поторгавать.

### Начальные параметры героя

Характеристики - начальные показатели персонажа, распределив в начали эти значения их нельзя превышать за исключением
специально оговоренных случаев{498}.

- Мастерство - дополнительный урон в бою который прибавляется к силе удара, чем выше тем лучше. Формула начального 
мастерства = [1-6] + 6. Враги также имеют показатели мастерства.

- Выносливость - выносливость своего рода очки здоровья и они уменьшаются при получении урона. Формула начальной
выносливости = [2-12] + 12. Враги также имееют показатели выносливости.

- Удача - переодически в игре проверяется удача броском кубика, начальный показатель прибавляется к результату.
Формула начальной удачи = [1-6] + 6. Проверка удачливости осуществляется по формуле Успешно = [2-12] <= Удача героя. 
После каждой проверки Удача героя уменьшается на 1. Если вы не хотите проверять Удачу или она <= 1 то считается, что
герой потерпел неудачу.

- Манна - позволяет пользоваться заклинаниями. Начальное количество манны 10. Использования заклинания обходится в одну 
манну.

Заклятия - можно использовать в любой момент, если позволяет параграф. Перед началом игры герою необходимо выбрать 10 
заклятий, они могут повторяться. Так-как выбор заклинания вызовет сложность для игрока, в самом начале это будет
дополнительный головняк, можно дать все заклинания и огнаничить количество использования до десяти

##### Перечень заклятий :

- Левитация - при определенных условиях предлагаемых в параграфе можно преодолеть препятствие;

- Огненный шар - при определенных условиях предлагаемых в параграфе можно атаковать врага огненным шаром;

- Иллюзия - при определенных обстоятельствах позволяет создать иллюзию, позволяет спастись и убежать с места боя,
если других вариантов нет;

- Сила - позволяет увеличить силу удара героя;

- Слабость - позволяет уменьшить силу врага и уменьшить силу удара;

- Копия - позволяет создать копию врага, с его текущим мастерством и ловкостью. Теперь вы нападаете на врага вдвоем. Если
противников несколько то прийдется драться с ними со всеми;

- Исцеление - в любой момент кроме сражения добавляет 8 Выносливости;

- Плавание - герой не умеет плавать, но с этим заклятием он может переплыть любой водоем один раз.

#### Инвентарь

Инвентарь - одновременно у игрока может быть до 7(9 если купить у торговца{176}) вещей с собой. Деньги и оружие не 
учитываются в инвентаре, можно носить, сколько позволяют условия в параграфе{126}. В любой момент (кроме битвы) можно 
выкладывать вещи и ложить другие.

Перечень вещей (список не полный):

| Название | Размер | В мешке | Макс кол-во | Описание | Параграф |
| :------: | -----: | ------: | ----------: | :------- | :------- |
| Заплечный мешок | 0 | - | 1 | Позволяет переонсить вещи | 176 |
| Фляга | 0 | - | 1 | Позволяет востанавливать Выносливость героя, содержит 2 глотка. Один глоток востанавливает 2 Выносливости. | 11 |
| Меч | 0 | - | 1 | Дает герою возможнось сражаться. | 126 |
| Деньги | 0 | - | 99 | По пути будут встречаться персонажы у которых можно обменять деньги. Начальное количество золота 15. | 18,448 |
| Золотое кольцо | 1 | + | 1 | | 356,355,356,388,602 |
| Золотой амулет | 1 | + | 1 | | 108,388,605 |
| Золотая устрица | 1 | + | 1 | | 448 |
| Золотой свисток | 1 | + | 1 | | 520,427 |
| Серебряный свисток | 1 | + | 1 | | 147,239,460,587 |
| Бронзовый свисток | 1 | + | 4 | | 294,355,394 |
| Четки | 1 | + | 1 | | 281,355 |
| Зеркальце | 1 | + | 1 | | 394,553,520,596 |
| Флакончик духов | 1 | + | 1 | | 171,394 |
| Золотое ожерелье | 1 | + | 1 | | 284,429 |
| Фигурный ключ | 1 | + | 1 | | 284,448 |
| Красивый кусочек дерева | 1 | + | 1 | | 448 |
| Попона для лошади | 1 | + | 1 | | 448 |
| Блестящий кусок металла | 1 | + | 1 | | 150,227,448 |
| Серебряный браслет | | | | | 448 |
| Подсвечник  | 1 | + | 1 | | 496 |
| Кнут | 1 | + | 1 | | 496 |
| Веревка | 1 | + | 1 | | 496 |
| Копье | 1 | + | 0 | | 402,496 |
| Меч "Смерть орков" | 1 | - | 0 | Если на пути вам встретится Орк, то исходбитвы с ним будет предрешен — вы убиваете его прежде, чем он успевает защититься. Однако если врагов будет несколько, то с остальными вам придется драться. | 291 |
| Щит | 1 | - | 1 | | 291,498 |
| Шкура оленя | 1 | + | 1 |  | 144,225,464 |
| Перстень с бриллиантом | 1 | + | 1 | Открывает двери в черном замке  | 464,600 |
| - | - | - | - | - | - |



### Бой

Против героя может выступать один враг или несколько одновременно. В некоторых случаях будет возможность избежать боя.
С выбранной целью бой проходит по стандартному алгоритму, но нужно будет сравнить силу удара с остальными противниками. 
Если Сила удара дополнительного противника превышает вашу, то вы получаете урон(-2 Выносливость). Вы не можете атаковать 
дополнительных врагов, только одного.

#### Алгоритм боя

##### С одним противником:

1. Враг атакует Сила удара врага(СУВ) = [2-12] + Мастерство врага
2. Герой атакует Сила удара героя(СУГ) = [2-12] + Мастерство героя
3. Если СУГ > СУВ, то вычтите 2 из Выносливости врага. Если СУГ < СУВ, то вычтите 2 из Выносливости героя. Если СУГ = СУВ,
то герой парировал атаку и бой продолжается.
4. Если у учасника боя Выносливость <= 0, то он считается поверженым. Если нет, то вернуться к действию 1.

##### Бой с несколькими противниками 

В бою сортируем последовательность атак по величине Силы удара (СУ), у кого она выше, тот и ходит раньше. В одной фазе
боя может быть одна цель со стороны врагов и одна цель со стороны Протоганиста(бой с копией). Если персонаж стоящий первым
погибает раньше чем походили все остальные противники и у них СУ больше чем у след цели, то их действия списываются на то, 
что они подходят к след цели.

3.Если СУГ > СУВ, то вычтите 2 из Выносливости врага. Если СУГ < СУВ, то вычтите 2 из Выносливости героя. Если СУГ = СУВ,
то герой парировал атаку и бой продолжается. Так же проведите итерацию с остальными врагами, они вам могут отнять 
выносливость, вы им нет.

##### Побег от противников

В некотороых случаях будет предоставлена возможность бегства, если герой выберет это действие, то ему нужно будет вычесть
2 Выносливости за каждого противника(удар в спину) на побег.

### Находки

В путешествии вы можете повстречать торговцев или лежащие выщи/еду которые можно забрать или сразу использовать 
(не во время боя). Пища востанавливает Выносливость, столько сколько поисано в параграфе. Не вся пища подходит для 
употребления, может отравить героя.


### Действия в игре(Параграф)

Вариации с которыми может столкнуться в игре.

###### Последовательность обработки параграфа:
1. Выполнение автоматических действий - вычитание/прибаление параметров и инвентаря, проверка удачи;
2. Филтрация допустимых действий - сравнение требований параграфа к имеющимся параметрами/инвентарем/заклинаниями у героя;
3. Вывод сформулированного контента игроку - отсеевания действий которые не может выполнить игрок и отображение только
доступных. К примеру, в параграфе спрашивается: "если у вас есть свисток?" мы не будем это спрашивать, если он у него 
есть, то просто предложим отдать/использовать эту вещь, если нет, то не выводим об этом информацию;
4. Отправка игроком действий - ввод данных игроком и отправка на обработку следующего шага.

###### Перечень действий:

- Переключение параграфа
	- Перемещение по карте{1}
	- Нападение на персонажей{18}
	- Применение заклятия(Плаванье/Левитация/Исцеление){4}
	- Расход фляги{11}
	- Секретные места{11->47->187, 67, 90, 520->(160|68)->135, 464, 144}
	- С какого параграфа пришел{122}
	- Завершение игры{24,56}
- Бой
	- Сражение с пративником/несколькими пративниками{6}
	- Последовательное сражение{33}
	- Временное уменьшение/увеличение Силы удара{54,58}
	- Применение заклятия(Копия/Сила/Слабость/Огненый шар){6}
	- Побег {33}
	- Бой с развитием через определенное количество ходов{65,301,569}
	- Поражение - проигрыш в бою конец игры.
- Редактирование инвентаря(вне боя)
	- Ложить вещи{22}
	- Убрать вещи
	- Использовать вещи{18,61} - может применяться прямо в параграфе или нужно прибавлять/вычитать из номера порагрофа
	орпеделенные числа для применения вещи.
- Использование фляги(вне боя)
- Автоматические действия
	- Проверка удачи{14,54}
	- Уменьшение/Увеличение Мастерства игрока/противника{32,126,395,498}
	- Уменьшение/Увеличение Удачи игрока{6,187}
	- Уменьшение/Увеличение Выносливости игрока/противника{7,16,21}
	- Получение/Потеря золота{6,17}
	- Пополнение инвентаря
	- Покупка пищи{209}


### Конструктор

Пока всеже думаю отказаться от конструктора, слишком ресурсно затратная затейя, он будет нужен, если ставить на поток.

>В конструкторе планируется вводить данные из параграфа и создавать связи между параграфами. Конструктор в виде странички
>или окна приложения. Состоит из форм и создания дополнительных форм. Формы будут разбиты на группы, каждая группа будет 
>отвечать за один шаг в обработке описаный в Последовательность обработки параграфа.

### Загадки и спец. места

Важные предметы - используются для решения игровых ситуций увеличивая номер параграфа и совершая определенное действие. 
Все эти предметы и их множители нужно вынести в конфиг игры с указанием ключа предмета и его номер параграфа или номера.
Иногда автор книги надеется на честность игрока и указывает прямо ссылку на пораграф{393,464}

## Игровой процесс

Игрок отправляет на определенный адрес письмо, ему приходит ответ с указаниями, что дольше делать. Он вводит в ответ 
нужное слово-команду и отправляет в ответ. Сервер обрабатывает запрос и если найдет подходящий  вариант для обработки 
вышлет ответ, если нет подходящего, то вернется письмо со справкой.

### Перемещение по параграфам:

Пользователь получил письмо{29}:

Деревня кажется нескончаемой, но вот и еще одна дорога. Теперь вам придется или \[пойти по ней\] или \[войти в деревню\].

Как видно номера параграфов заменены на слова команды, которые нужно ввести в ответ в письме.

Пользователь отвечает{184}:

войти в деревню

В ответ приходит письмо:

Вы входите в деревню. Жители, попадающиеся навстречу, смотрят с нескрываемым подозрением. Чувствуется их недоброжелательность, 
и вы решаете поскорее покинуть негостеприимных людей. Хотите \[уйти сразу\] или все же поговорите с одним из крестьян? 
Если да, то о чем вы спросите его: \[как лучше попасть в Черный замок\] \[где можно купить еду\] или \[что находится 
поблизости от деревни\]?

#### Автоперемещение по параграфам:
Если при заходе на параграф там автоматически перемещает игрока дальше то нам следует это делать сразу без ожидания
подтверждения от игрока, текст их этого параграфа тоже нужно выводить. Пример - {122} Игрок пришел с 190 параграфа, то 
мы ему выведим сообщение:

>Вы называете пароль, и вас беспрепятственно пропускают в замок.

>Вы оказываетесь во дворе Черного замка. Яркий свет факелов прямо перед вами заставляет остановиться и спрятаться в нише 
>ворот. Двор наполнен Гоблинами и Орками, они снуют между палаток, тут и там горят костры. Вы чуть было не оказались в 
>самом центре военного лагеря врага. За палатками, в центре двора, виднеется большое мрачное строение. Судя по всему, это 
>и есть цель вашего путешествия. Как ни странно, река течет и здесь — справ от вас. При мерцающем свете видно, что вода 
>уходит под землю где-то неподалеку от центрального здания. Вам надо решать, куда направиться. \[к реке\] или \[к палаткам\]?


### Бой

Пользователь получил письмо{190}:

Около ворот стоят три Орка. У двух — большие боевые топоры, у третьего — меч. Вы понимаете, что легко проникнуть внутрь 
не удастся. Если вы знаете пароль, воспользуйтесь им (\[напите пароль\]), если же нет, то придется на ходу быстро придумать,
что вы скажете стражам. Можете сказать, что вы бродячий торговец и \[идете в замок торговать\], что вы азартный игрок и 
\[идете развлекать волшебника\] или что вы собираетесь наняться \[служить в его армии\]. Если же у вас не хватает воображения, 
ну что ж, тогда \[сражайтесь\].

Пользователь отвечает{341}:

сражайтесь

В ответ получает письмо:

> В зависимости от того, есть ли у пользователя заклятия, если есть то выводим это письмо

Вы можете воспользоваться заклятиями \[Силы\], \[Слабости\], \[Огня\] или \[драться мечом\].

> Если нет, то сразу без ответа переводим в бой{487}

У пользователя были заклятия и он ответил:

Слабасти

Пользователь получил ответ:

Выбранное дейстивие __Слабасти__ не поддерживается, пожалуйста выберите активные действия.

Вы можете воспользоваться заклятиями \[Силы\], \[Слабости\], \[Огня\] или \[драться мечом\].

Пользователь отвечает{289}:

Слабости

В ответ приходит письмо{487}:

> Так как действие перенаправляет пользователя с 289 на 487 без выбора то мы просто пропускаем это параграф и выводим уже 
результа перенаправления.

Первым нападает Орк с мечом, который расспрашивал вас. Если хотите, воспользуйтесь заклятием \[Копии\] или \[сражайтесь\].

Пользователь отвечает:

Копии

Приходит ответ:

>Бой расчитывается автоматически, а игроку выводится уже результат в пошаговом представлении. Имена NPC предлагаю давать
из книг Толкиена. 
>У героя выпло СУ = 12 у копия Азога СУ 14 у Азога СУ 13 так как враг вначале сражается с копией то он не достает до героя 
и не может поразить копию копия Азога СУ > Азог СУ, а копия наносит урон Азогу. Атаки с промохом не будем выводить чтоб 
не захламлять вывод.

Копия Азога ранит Азога.

> Герой(8) СУ = 11 копия Азога(6) СУ = 11 Азог(4) = 12 

Азог ранит Копию Азога.

> Герой(8) СУ = 15 копия Азога(4) СУ = 12 Азог(4) СУ = 14. 

_Имя героя_ ранит Азога в левую руку.

Азог бьет мечем в ногу Копию Азога.

> Герой(8) СУ = 10 Копия Азога(2) СУ = 16 Азог(2) СУ = 15 Балкмег(7) СУ = 17 Болдог(7) СУ = 10

Балкмег смертельно ранит Копию Азога.

> Герой(8) СУ = 13 Азог(2) = СУ = 12 Балкмег(7) СУ = 11 Болдог(7) СУ = 14

Болдог наносит удар по _Имя героя_

_Имя героя_ убивает Азога

... и так далее до поражения или победы. Если победа и варинт развития всего один, то переходим автоматически на него{100}.
Если поражение то выводим сообщение, _Имя героя_ встретил свою сметрь в лице _Имя врага_ и инструкцию как начать заново.

## Технологии

#### ЯП

- Python

#### Хранилище данных

- MongoDB - структура данных не однозначна по этому будем использовать не реляционную бд.
- Redis - Или можно вообще ограничиться KeyValue и сохранять состояние игрового процесса в сериализованных данных

## Справка

В квадратных скобках ([1-6]) указывается числовой промежуток(бросок кубика/кубиков), случайное число из этого промежутка.

В фигурных скобках {} номер параграфа с примером действия
